services:
  # --------------------------------------------------------------------------
  #  ğŸŒ ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚· & HTTPSçµ‚ç«¯ (Caddy)
  # --------------------------------------------------------------------------
  caddy:
    image: caddy:2-alpine
    container_name: proxy-caddy
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
      - "443:443/udp" # HTTP/3 (QUIC) ç”¨
    volumes:
      - ./caddy/Caddyfile:/etc/caddy/Caddyfile # Entryãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«Caddyfileã‚’é…ç½®ã™ã‚‹æƒ³å®š
      - caddy_data:/data
      - caddy_config:/config
    environment:
      - ACME_AGREE=true
      - TZ=Asia/Tokyo
    networks:
      - frontend_network
      - shared_backend_network
    depends_on:
      - account_api
      - log_api
      - backup_api
      - pgadmin
      - duplicati
      - portainer

  # --------------------------------------------------------------------------
  #  ğŸŒ DNS (CoreDNS)
  # --------------------------------------------------------------------------
  coreDNS:
    image: coredns/coredns:latest
    container_name: dns-coredns
    ports:
      - "${HOST_IP}:53/tcp"
      - "${HOST_IP}:53/udp"
    env_file:
      - ../.env # ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§
    volumes:
      - ./Corefile:/Corefile # Entryãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«Corefileã‚’é…ç½®ã™ã‚‹æƒ³å®š
    command: -conf /Corefile
    restart: unless-stopped
    networks:
      - shared_backend_network